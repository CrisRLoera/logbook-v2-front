<div class="w-100">
    <h4 class="mb-5">Reportes de estudiantes</h4>
    <!-- Alerta de error al no ingresar correctamente el campo -->
    <ngb-alert #selfClosingAlert *ngIf="errorMessage" type="danger" (closed)="errorMessage = ''" class="mb-4">{{ errorMessage }}</ngb-alert>
    <div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-5">
        <!-- Campo para ingresar el laboratorio deseado -->
        <div class="col">
            <h5 class="fs-5 mb-3 w-100">Laboratorio</h5>
            <input class="input-typeahead fs-5 w-100" type="text" placeholder="Ingrese el nombre del laboratorio" name="lab" [(ngModel)]="selectedLab" [ngbTypeahead]="searchLabs" [inputFormatter]="labFormatter" [resultFormatter]="labFormatter" [editable]="false"/>
        </div>
        <!-- Campo para ingresar la carrera deseada -->
        <div class="col">
            <h5 class="fs-5 mb-3 w-100">Carrera</h5>
            <input class="input-typeahead fs-5 w-100" type="text" placeholder="Ingrese el nombre de la carrera" name="lab" [(ngModel)]="selectedLab" [ngbTypeahead]="searchLabs" [inputFormatter]="labFormatter" [resultFormatter]="labFormatter" [editable]="false"/>
        </div>
        <!-- Campo para seleccionar la clase desada -->
        <div class="col">
            <h5 class="fs-5 mb-3 w-100">Clase</h5>
            <input class="input-typeahead w-100 fs-5 mb-4" type="text" placeholder="Ingrese el nombre de la clase" name="course" [(ngModel)]="selectedCourse" [ngbTypeahead]="searchCourses" [inputFormatter]="courseFormatter" [resultTemplate]="rt" [editable]="false"/>
        </div>
        <!-- Campo para seleccionar el rango de fechas -->
        <div class="col">
            <h5 class="fs-5 mb-3 w-100">Rango de fechas</h5>
            <p-calendar styleClass="custom-calendar" placeholder="Seleccione un rango de fechas" [(ngModel)]="rangeDates" selectionMode="range" [readonlyInput]="true" inputId="range" [showIcon]="true" [numberOfMonths]="2" appendTo="body"></p-calendar>
        </div>
    </div>
    <div class="w-100 d-flex align-items-center justify-content-end mt-4 mb-5">
        <button id="pdf-btn" type="button" class="btn btn-dark me-3" >Guardar PDF</button>
        <button id="generate-btn" type="button" class="btn btn-dark" (click)="getStudentReports()">Generar</button>
    </div>
    <!-- Tabla que muestra el resultado al generar una consulta con los campos ingresados -->
    <p-table *ngIf="studentReports.length > 0" [value]="studentReports" [scrollable]="true" scrollHeight="350px" [virtualScroll]="true" [virtualScrollItemSize]="46" styleClass="table-header">
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="id">Matricula <p-sortIcon field="id"></p-sortIcon></th>
                <th pSortableColumn="name">Nombre <p-sortIcon field="name"></p-sortIcon></th>
                <th pSortableColumn="group">Laboratorio <p-sortIcon field="lab"></p-sortIcon></th>
                <th pSortableColumn="course">Clase <p-sortIcon field="course"></p-sortIcon></th>
                <th pSortableColumn="date">Fecha <p-sortIcon field="date"></p-sortIcon></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-student>
            <tr>
                <td>{{student.id}}</td>
                <td>{{student.name}}</td>
                <td>{{student.lab}}</td>
                <td>{{student.course}}</td>
                <td>{{student.date}}</td>
            </tr>
        </ng-template>
    </p-table>
</div>
<!-- Template sobre la lista de sugerencias para la selecciÃ³n de la clase -->
<ng-template #rt let-r="result" let-t="term">
    <div class="d-flex flex-column align-items-start justify-content-center">
        <ngb-highlight [result]="r.name" [term]="t" class="fs-6"></ngb-highlight>
        <ngb-highlight [result]="r.professor.name" [term]="t" class="professor-dropdown fs-6"></ngb-highlight>
    </div>
</ng-template>